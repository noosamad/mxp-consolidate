PROCEDURE reportScript
STARTREPORT
NOHEADERS
NOGRIDLINES
API_START
... seclist is the various sections that will be used in profit and loss and balance sheet reports
... plan to move this out to ini file or transaction model later
DEFAULT curtransacc='6999 - Currency Translation Expense'
DEFAULT seclist[1]='Bank'
DEFAULT seclist[2]='Receivables'
DEFAULT seclist[3]='Other Current Asset'
DEFAULT seclist[4]='Fixed Assets'
DEFAULT seclist[5]='Payables'
DEFAULT seclist[6]='Other Current Liability'
DEFAULT seclist[7]='Equity'
DEFAULT seclist[8]='Income'
DEFAULT seclist[9]='Cost of Goods Sold'
DEFAULT seclist[10]='Expenses'
DEFAULT seclist[11]='Other Income'
DEFAULT seclist[12]='Other Expense'
... pnlseclist defines which section are used in Profit and Loss, again this can be either an ini file or a transaction model
... the items in this list MUST exist in seclist
DEFAULT pnlseclist[1]='Income'
DEFAULT pnlseclist[2]='Cost of Goods Sold'
DEFAULT pnlseclist[3]='Expenses'
DEFAULT pnlseclist[4]='Other Income'
DEFAULT pnlseclist[5]='Other Expense'
... bsseclist defines which sections used in Balance Sheet, again this can be either an ini file or a transaction model
... the items in this list MUST exist in seclist
DEFAULT bsseclist[1]='Bank'
DEFAULT bsseclist[2]='Receivables'
DEFAULT bsseclist[3]='Other Current Assets'
DEFAULT bsseclist[4]='Fixed Assets'
DEFAULT bsseclist[5]='Payables'
DEFAULT bsseclist[6]='Other Current Liability'
DEFAULT bsseclist[7]='Equity'
... initial list arrays used to store the COA data
DEFAULT accname[1]=''
DEFAULT accsection[1]=''
DEFAULT acctype[1]=''
DEFAULT accparent[1]=''
DEFAULT accflag[1]=0
PROJECT 'MXP Consolidation 2010' OWNER 'gparsons'
MODEL 'CommonCOA'
... load all the data from the trasnaction model into list variables
READ MEMORY 'All'
accname=SERIES3
accsection=SERIES4
acctype=SERIES5
accparent=SERIES6
accflag=SERIES7
nritems=ITEMSINFO('accname','ITEMS')
...
... create Profit and Loss Measures List
...
mcount=0
curtransexp=' '
quot='''
...loop through each account to determine the items which are DETAIL items 
... only details items need outputting as valid measures for eliminations
FOR j,1,nritems,1
    ... loop through finding all accounts belonging to this section
    WHEN lowercase(acctype[j]) EQ 'detail' and lowercase(accname[j]) NE lowercase(curtransacc)
            mcount=mcount+1
            measurelist[mcount]=accname[j]
            mhide[mcount]='showData'
            mbold[mcount]=0
            mexpression[mcount]=' '
            SWITCH
                CASE accflag[j] EQ 1
                        curtransexp=concat(curtransexp,'-',quot,accname[j],quot)
                CASE accflag[j] EQ -1
                        curtransexp=concat(curtransexp,'+',quot,accname[j],quot)
            ENDSWITCH
    ENDWHEN
ENDFOR
... Output Currency Translation Calculation
... Now loop through and show what we have
FOR j,1,mcount,1
    columnwidth 300,1-2
    TEXT measurelist[j]
    SAMELINE
    TEXT mexpression[j]
    TEXT mhide[j]
    DIFFERENTLINE
ENDFOR
TEXT curtransacc
text curtransexp
... Update the Elims model with the new measures
PROJECT 'MXP Consolidation 2010' OWNER 'gparsons'
MODEL 'Eliminations'
TEXT 'Write Measures'
api_measure
     with dimension = 'measure'
     with option = 'ADD'
     with sourceMember = measurelist
     with expression = mexpression
     with hide = mhide
     with measureBold = mbold
TEXT 'Write CurTrans Measure'
.api_measure
.     with dimension = 'measure'
.     with option = 'ADD'
.     with sourceMember = curtransacc
.     with expression =' '
TEXT 'Write CurTrans Consolidated'
api_measure
     with dimension = 'consolidated'
     with option = 'ADD'
     with sourceMember = curtransacc
     with expression = curtransexp
.     
.PROJECT #_apiLibrary OWNER 'gparsons'
.MODEL 'ElimFlags'
.api_measure
.     with dimension = 'measure'
.     with option = 'ADD'
.     with sourceMember = measurelist
.     with expression = mexpression
.     with hide = mhide
.     with measureBold = mbold
ENDREPORT
API_END
RETURN
